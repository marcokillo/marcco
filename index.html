<!DOCTYPE html>
<html lang="fa" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قفل ترکیبی حرفه‌ای</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazir:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Mobile First - Base Styles */
        body {
            background: radial-gradient(ellipse at center, #2a2a2a 0%, #1a1a1a 40%, #0a0a0a 100%);
            font-family: 'Vazir', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
            touch-action: manipulation;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 10px,
                    rgba(255,255,255,0.01) 10px,
                    rgba(255,255,255,0.01) 20px
                );
            pointer-events: none;
        }

        .myCenter {
            position: relative;
            text-align: center;
            perspective: 800px;
            width: 100%;
            max-width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .myLock {
            display: inline-block;
            text-align: center;
            padding: 30px 25px;
            background: 
                linear-gradient(145deg, #f8f8f8 0%, #e8e8e8 20%, #d0d0d0 40%, #b8b8b8 60%, #a0a0a0 80%, #909090 100%),
                radial-gradient(ellipse at top left, rgba(255,255,255,0.4) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(0,0,0,0.2) 0%, transparent 50%);
            background-blend-mode: normal, overlay, multiply;
            border-radius: 25px;
            box-shadow: 
                0 2px 5px rgba(255,255,255,0.5) inset,
                0 -2px 5px rgba(0,0,0,0.3) inset,
                0 20px 40px rgba(0,0,0,0.5),
                0 8px 16px rgba(0,0,0,0.7),
                0 0 0 1px rgba(255,255,255,0.1);
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(1deg);
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
            touch-action: none; /* جلوگیری از scroll */
        }

        .myLock * {
            touch-action: none;
        }

        .myLock::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: 
                radial-gradient(ellipse at top, rgba(255,255,255,0.15) 0%, transparent 70%);
            border-radius: 30px;
            z-index: -1;
        }

        .lockInset {
            display: inline-block;
            position: relative;
            padding: 25px 15px;
            background: 
                linear-gradient(135deg, #e0e0e0 0%, #c8c8c8 25%, #b0b0b0 50%, #989898 75%, #808080 100%),
                radial-gradient(ellipse at center, rgba(255,255,255,0.2) 0%, transparent 70%);
            border-radius: 20px;
            box-shadow: 
                0 -3px 6px rgba(255,255,255,0.7) inset,
                0 3px 6px rgba(0,0,0,0.5) inset,
                0 12px 24px rgba(0,0,0,0.3),
                0 4px 8px rgba(0,0,0,0.5);
            width: 100%;
            touch-action: none;
        }

        .lockLine {
            position: absolute;
            left: -25px;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            height: 6px;
            background: 
                linear-gradient(90deg, 
                    rgba(0,0,0,0.4) 0%, 
                    rgba(0,0,0,0.2) 45%, 
                    rgba(0,0,0,0.4) 50%, 
                    rgba(0,0,0,0.2) 55%, 
                    rgba(0,0,0,0.4) 100%
                );
            border-radius: 3px;
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.5) inset,
                0 -1px 2px rgba(255,255,255,0.2);
        }

        .lockWrapper {
            text-align: center;
            position: relative;
            background: 
                linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 10%, #1a1a1a 20%, #0d0d0d 80%, #000000 100%),
                radial-gradient(ellipse at center, rgba(255,255,255,0.05) 0%, transparent 70%);
            border-radius: 12px;
            height: 150px;
            box-shadow: 
                0 -2px 4px rgba(255,255,255,0.1) inset,
                0 2px 8px rgba(0,0,0,0.8) inset,
                0 8px 16px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            direction: ltr;
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            touch-action: none;
        }

        .dial {
            display: inline-block;
            vertical-align: top;
            height: 130px;
            width: 65px;
            margin: 0 2px;
            border-radius: 8px;
            overflow: hidden;
            font-size: 36px;
            font-family: 'Vazir', monospace;
            font-weight: 700;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            flex: 1;
            touch-action: pan-y; /* فقط اجازه swipe عمودی */
            user-select: none;
        }

        .dial:active {
            transform: scale(0.98);
            transition: transform 0.1s ease;
        }

        /* رنگ‌های دایال‌ها (بدون تغییر) */
        .dial:nth-child(1) {
            background: 
                linear-gradient(180deg,
                    #001133 0%,
                    #002255 8%,
                    #003377 16%,
                    #004499 24%,
                    #0055bb 32%,
                    #0066dd 40%,
                    #0077ff 48%,
                    #4499ff 50%,
                    #0077ff 52%,
                    #0066dd 60%,
                    #0055bb 68%,
                    #004499 76%,
                    #003377 84%,
                    #002255 92%,
                    #001133 100%
                ),
                radial-gradient(ellipse at 30% 0%, rgba(255,255,255,0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 100%, rgba(0,0,0,0.3) 0%, transparent 50%);
            background-blend-mode: normal, screen, multiply;
            border: 1px solid #003366;
            box-shadow: 
                0 -2px 4px rgba(255,255,255,0.4) inset,
                0 2px 4px rgba(0,0,0,0.6) inset,
                0 0 15px rgba(0,119,255,0.4),
                0 8px 20px rgba(0,0,0,0.4);
            color: #ffffff;
            text-shadow: 
                0 0 8px rgba(255,255,255,0.8),
                0 2px 4px rgba(0,0,0,0.8),
                0 0 15px rgba(0,119,255,0.5);
        }

        .dial:nth-child(2) {
            background: 
                linear-gradient(180deg,
                    #330000 0%,
                    #550000 8%,
                    #770000 16%,
                    #990000 24%,
                    #bb0000 32%,
                    #dd0000 40%,
                    #ff0000 48%,
                    #ff4444 50%,
                    #ff0000 52%,
                    #dd0000 60%,
                    #bb0000 68%,
                    #990000 76%,
                    #770000 84%,
                    #550000 92%,
                    #330000 100%
                ),
                radial-gradient(ellipse at 30% 0%, rgba(255,255,255,0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 100%, rgba(0,0,0,0.3) 0%, transparent 50%);
            background-blend-mode: normal, screen, multiply;
            border: 1px solid #660000;
            box-shadow: 
                0 -2px 4px rgba(255,255,255,0.4) inset,
                0 2px 4px rgba(0,0,0,0.6) inset,
                0 0 15px rgba(255,0,0,0.4),
                0 8px 20px rgba(0,0,0,0.4);
            color: #ffffff;
            text-shadow: 
                0 0 8px rgba(255,255,255,0.8),
                0 2px 4px rgba(0,0,0,0.8),
                0 0 15px rgba(255,0,0,0.5);
        }

        .dial:nth-child(3) {
            background: 
                linear-gradient(180deg,
                    #332200 0%,
                    #554400 8%,
                    #776600 16%,
                    #998800 24%,
                    #bbaa00 32%,
                    #ddcc00 40%,
                    #ffee00 48%,
                    #ffff44 50%,
                    #ffee00 52%,
                    #ddcc00 60%,
                    #bbaa00 68%,
                    #998800 76%,
                    #776600 84%,
                    #554400 92%,
                    #332200 100%
                ),
                radial-gradient(ellipse at 30% 0%, rgba(255,255,255,0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 100%, rgba(0,0,0,0.3) 0%, transparent 50%);
            background-blend-mode: normal, screen, multiply;
            border: 1px solid #665500;
            box-shadow: 
                0 -2px 4px rgba(255,255,255,0.5) inset,
                0 2px 4px rgba(0,0,0,0.6) inset,
                0 0 15px rgba(255,204,0,0.4),
                0 8px 20px rgba(0,0,0,0.4);
            color: #000000;
            text-shadow: 
                0 0 8px rgba(255,255,255,0.9),
                0 1px 2px rgba(255,255,255,0.8),
                0 -1px 2px rgba(0,0,0,0.3);
        }

        .dial:nth-child(4) {
            background: 
                linear-gradient(180deg,
                    #000000 0%,
                    #0a0a0a 8%,
                    #1a1a1a 16%,
                    #2a2a2a 24%,
                    #3a3a3a 32%,
                    #4a4a4a 40%,
                    #5a5a5a 48%,
                    #6a6a6a 50%,
                    #5a5a5a 52%,
                    #4a4a4a 60%,
                    #3a3a3a 68%,
                    #2a2a2a 76%,
                    #1a1a1a 84%,
                    #0a0a0a 92%,
                    #000000 100%
                ),
                radial-gradient(ellipse at 30% 0%, rgba(255,255,255,0.5) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 100%, rgba(0,0,0,0.5) 0%, transparent 50%);
            background-blend-mode: normal, screen, multiply;
            border: 1px solid #333333;
            box-shadow: 
                0 -2px 4px rgba(255,255,255,0.6) inset,
                0 2px 4px rgba(0,0,0,0.8) inset,
                0 0 20px rgba(255,255,255,0.2),
                0 8px 20px rgba(0,0,0,0.5);
            color: #ffffff;
            text-shadow: 
                0 0 8px rgba(255,255,255,1),
                0 2px 4px rgba(0,0,0,1),
                0 0 15px rgba(255,255,255,0.4);
        }

        .dial ol {
            list-style: none;
            position: relative;
            top: 45px;
            transition: top 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 0;
            margin: 0;
        }

        .dial ol li {
            display: block;
            height: 45px;
            line-height: 45px;
            margin: 0;
            font-weight: 700;
            text-align: center;
            position: relative;
            padding: 0;
        }

        .shadow {
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(180deg,
                    rgba(0,0,0,0.9) 0%,
                    rgba(0,0,0,0.7) 10%,
                    rgba(0,0,0,0.3) 25%,
                    transparent 40%,
                    transparent 60%,
                    rgba(0,0,0,0.3) 75%,
                    rgba(0,0,0,0.7) 90%,
                    rgba(0,0,0,0.9) 100%
                );
            border-radius: 8px;
            z-index: 10;
        }

        /* دکمه کوچک‌تر */
        .btnEnter {
            font-size: 16px;
            font-family: 'Vazir', sans-serif;
            font-weight: 700;
            color: #1a1a1a;
            cursor: pointer;
            margin: 20px auto 0;
            width: 200px;
            height: 40px;
            line-height: 40px;
            display: block;
            background: 
                linear-gradient(145deg, #f0f0f0 0%, #e0e0e0 50%, #d0d0d0 100%),
                radial-gradient(ellipse at top, rgba(255,255,255,0.8) 0%, transparent 60%);
            background-blend-mode: normal, overlay;
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 
                0 -3px 6px rgba(255,255,255,0.9) inset,
                0 3px 6px rgba(0,0,0,0.3) inset,
                0 6px 12px rgba(0,0,0,0.2),
                0 3px 6px rgba(0,0,0,0.4);
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
            touch-action: manipulation;
        }

        .btnEnter:active {
            transform: translateY(1px);
            box-shadow: 
                0 -1px 3px rgba(255,255,255,0.6) inset,
                0 1px 3px rgba(0,0,0,0.4) inset,
                0 2px 6px rgba(0,0,0,0.2);
            transition: all 0.1s ease;
        }

        .btnEnter::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.6), 
                transparent
            );
            transition: left 0.6s ease;
        }

        .btnEnter:active::before {
            left: 100%;
        }

        /* پیام خطا - بالای صفحه */
        .error-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.95) 0%, rgba(255, 0, 0, 0.9) 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 
                0 8px 25px rgba(255, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-align: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 180px;
            max-width: 90vw;
            font-family: 'Vazir', sans-serif;
            border-radius: 50px;
        }

        .error-message.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
            animation: errorShake 0.5s ease-in-out;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            25% { transform: translateX(-50%) translateY(0) translateX(-8px); }
            75% { transform: translateX(-50%) translateY(0) translateX(8px); }
        }

        .status-display {
            position: absolute;
            top: -35px;
            right: 15px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(20,20,20,0.8) 100%);
            color: #ff4444;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 
                0 4px 12px rgba(0,0,0,0.4),
                0 1px 4px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            min-width: 80px;
            text-align: center;
        }

        .status-display.success {
            color: #44ff44;
            animation: successPulse 0.6s ease;
            box-shadow: 
                0 4px 16px rgba(68,255,68,0.3),
                0 1px 4px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .current-combo {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: 
                linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%),
                radial-gradient(ellipse at top, rgba(255,255,255,0.1) 0%, transparent 60%);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 4px;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.1),
                inset 0 -2px 4px rgba(0,0,0,0.5),
                0 8px 24px rgba(0,0,0,0.5),
                0 4px 12px rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.1);
            font-family: 'Courier New', monospace;
            min-width: 100px;
            text-align: center;
            backdrop-filter: blur(8px);
            position: relative;
            overflow: hidden;
        }

        .current-combo::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.1), 
                transparent
            );
            animation: comboShine 3s linear infinite;
        }

        @keyframes comboShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .current-combo::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                #0077ff, #ff0077, #77ff00, #ff7700, #0077ff
            );
            border-radius: 25px;
            opacity: 0.3;
            z-index: -1;
            animation: borderRotate 4s linear infinite;
            filter: blur(2px);
        }

        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tablet Styles */
        @media (min-width: 481px) and (max-width: 768px) {
            .myLock {
                padding: 40px 50px;
                max-width: 400px;
            }
            
            .lockInset {
                padding: 30px 20px;
            }
            
            .dial {
                width: 75px;
                margin: 0 4px;
                font-size: 40px;
            }
            
            .dial ol {
                top: 50px;
            }
            
            .dial ol li {
                height: 50px;
                line-height: 50px;
            }
            
            .lockWrapper {
                height: 170px;
            }
            
            .btnEnter {
                width: 240px;
                font-size: 18px;
                height: 45px;
                line-height: 45px;
            }

            .status-display {
                top: -40px;
                right: 20px;
                font-size: 13px;
                padding: 10px 15px;
            }

            .current-combo {
                font-size: 22px;
                letter-spacing: 5px;
                padding: 14px 25px;
                bottom: -55px;
            }

            .error-message {
                font-size: 18px;
                padding: 14px 28px;
                min-width: 200px;
                top: 25px;
            }
        }

        /* Desktop Styles */
        @media (min-width: 769px) {
            .myCenter {
                padding: 40px;
                perspective: 1200px;
            }
            
            .myLock {
                padding: 60px 70px;
                max-width: 500px;
                border-radius: 35px;
                transform: rotateX(2deg);
            }
            
            .lockInset {
                padding: 35px;
                border-radius: 25px;
            }
            
            .lockLine {
                left: -35px;
                right: -35px;
                height: 8px;
            }
            
            .lockWrapper {
                height: 200px;
                border-radius: 15px;
                padding: 10px;
            }
            
            .dial {
                height: 180px;
                width: 95px;
                margin: 0 10px;
                border-radius: 10px;
                font-size: 52px;
            }
            
            .dial ol {
                top: 60px;
            }
            
            .dial ol li {
                height: 60px;
                line-height: 60px;
            }
            
            .btnEnter {
                width: 260px;
                font-size: 20px;
                height: 50px;
                line-height: 50px;
                border-radius: 25px;
            }

            .status-display {
                top: -45px;
                right: 20px;
                font-size: 14px;
                padding: 10px 18px;
                border-radius: 25px;
            }

            .current-combo {
                font-size: 24px;
                letter-spacing: 8px;
                padding: 15px 30px;
                bottom: -60px;
                border-radius: 30px;
                min-width: 120px;
            }

            .error-message {
                font-size: 20px;
                padding: 16px 32px;
                min-width: 220px;
                top: 30px;
                border-radius: 50px;
            }
        }

        /* Landscape Mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .myCenter {
                padding: 10px;
            }
            
            .myLock {
                padding: 20px 15px;
                margin: 10px;
            }
            
            .lockInset {
                padding: 20px 10px;
            }
            
            .lockWrapper {
                height: 120px;
            }
            
            .dial {
                height: 110px;
                width: 55px;
                font-size: 30px;
            }
            
            .dial ol {
                top: 35px;
            }
            
            .dial ol li {
                height: 38px;
                line-height: 38px;
            }
            
            .btnEnter {
                width: 180px;
                font-size: 14px;
                height: 36px;
                line-height: 36px;
                margin: 15px auto 0;
            }

            .current-combo {
                position: static;
                margin: 15px auto 0;
                transform: none;
                font-size: 16px;
                letter-spacing: 3px;
                padding: 10px 15px;
            }

            .status-display {
                position: static;
                margin: 10px auto 0;
                transform: none;
                display: inline-block;
            }

            .error-message {
                position: fixed;
                top: 10px;
                font-size: 14px;
                padding: 10px 20px;
                min-width: 160px;
            }
        }

        /* High DPI Displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .dial {
                border-width: 0.5px;
            }
            
            .btnEnter {
                border-width: 0.5px;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: radial-gradient(ellipse at center, #1a1a1a 0%, #0a0a0a 40%, #000000 100%);
            }
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="myCenter">
        <div id="lock" data-dials="4">
            <div class="status-display" id="statusDisplay">قفل شده</div>
            <div class="current-combo" id="currentCombo">0000</div>
        </div>
    </div>

    <!-- پیام خطا - بالای صفحه -->
    <div class="error-message" id="errorMessage">رمز اشتباه است!</div>

    <script>
        class CombinationLock {
            constructor(element, options = {}) {
                this.element = element;
                this.dials = options.dials || parseInt(element.dataset.dials) || 4;
                this.correctCode = options.correctCode || '5263';
                this.currentCode = new Array(this.dials).fill(0);
                this.isLocked = true;
                this.dialPositions = new Array(this.dials).fill(0);
                this.isAnimating = false;
                this.touchStartY = 0;
                this.isTouching = false;
                this.errorMessage = document.getElementById('errorMessage');
                this.swipeThreshold = 10; // کاهش threshold به 10 برای حساسیت بیشتر
                
                this.init();
            }
            
            init() {
                this.buildLock();
                this.attachEvents();
                this.updateDisplay();
            }
            
            buildLock() {
                this.element.className = 'myLock';
                
                const lockInset = document.createElement('div');
                lockInset.className = 'lockInset';
                
                const lockLine = document.createElement('div');
                lockLine.className = 'lockLine';
                
                const lockWrapper = document.createElement('div');
                lockWrapper.className = 'lockWrapper';
                
                // Create dials
                for (let i = 0; i < this.dials; i++) {
                    const dial = document.createElement('div');
                    dial.className = 'dial';
                    dial.dataset.index = i;
                    
                    const ol = document.createElement('ol');
                    
                    // اضافه کردن اعداد 0 تا 9 و کپی برای چرخش روان
                    for (let n = 0; n <= 10; n++) { // 0 to 9 + extra 0
                        const li = document.createElement('li');
                        li.textContent = n % 10;
                        ol.appendChild(li);
                    }
                    
                    dial.appendChild(ol);
                    lockWrapper.appendChild(dial);
                }
                
                const shadow = document.createElement('div');
                shadow.className = 'shadow';
                lockWrapper.appendChild(shadow);
                
                lockInset.appendChild(lockLine);
                lockInset.appendChild(lockWrapper);
                
                const enterBtn = document.createElement('div');
                enterBtn.className = 'btnEnter';
                enterBtn.textContent = '🔓 باز کردن';
                enterBtn.id = 'enterBtn';
                
                this.element.appendChild(lockInset);
                this.element.appendChild(enterBtn);
            }
            
            attachEvents() {
                const dials = this.element.querySelectorAll('.dial');
                const enterBtn = this.element.querySelector('#enterBtn');
                
                // Touch events for mobile - بهبود یافته با تشخیص مداوم حرکت
                dials.forEach((dial, index) => {
                    let touchStartY = 0;
                    let lastDeltaY = 0;
                    let isTouching = false;
                    
                    dial.addEventListener('touchstart', (e) => {
                        if (this.isAnimating) return;
                        touchStartY = e.touches[0].clientY;
                        lastDeltaY = 0;
                        isTouching = true;
                        e.preventDefault();
                    }, { passive: false });
                    
                    dial.addEventListener('touchmove', (e) => {
                        if (!isTouching || this.isAnimating) return;
                        const currentY = e.touches[0].clientY;
                        const deltaY = touchStartY - currentY; // معکوس برای جهت طبیعی (بالا کشیدن = افزایش عدد)
                        const deltaChange = deltaY - lastDeltaY;
                        
                        if (Math.abs(deltaChange) > this.swipeThreshold) {
                            const steps = Math.floor(Math.abs(deltaChange) / this.swipeThreshold);
                            const direction = deltaChange > 0 ? 1 : -1;
                            
                            for (let i = 0; i < steps; i++) {
                                this.rotateDialWithDirection(index, direction);
                            }
                            
                            lastDeltaY += steps * this.swipeThreshold * (direction > 0 ? 1 : -1);
                        }
                        
                        e.preventDefault();
                    }, { passive: false });
                    
                    dial.addEventListener('touchend', (e) => {
                        isTouching = false;
                        this.snapToNearest(index);
                        e.preventDefault();
                    }, { passive: false });
                    
                    // Click event for desktop/mobile tap
                    dial.addEventListener('click', (e) => {
                        if (!this.isAnimating) {
                            this.rotateDialWithDirection(index, 1);
                        }
                        e.preventDefault();
                    });
                });
                
                // Mouse events for desktop - بهبود یافته
                dials.forEach((dial, index) => {
                    let startY = 0;
                    let lastDeltaY = 0;
                    let isDragging = false;
                    
                    dial.addEventListener('mousedown', (e) => {
                        if (this.isAnimating) return;
                        startY = e.clientY;
                        lastDeltaY = 0;
                        isDragging = true;
                        e.preventDefault();
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging || this.isAnimating) return;
                        const currentY = e.clientY;
                        const deltaY = startY - currentY;
                        const deltaChange = deltaY - lastDeltaY;
                        
                        if (Math.abs(deltaChange) > this.swipeThreshold) {
                            const steps = Math.floor(Math.abs(deltaChange) / this.swipeThreshold);
                            const direction = deltaChange > 0 ? 1 : -1;
                            
                            for (let i = 0; i < steps; i++) {
                                this.rotateDialWithDirection(index, direction);
                            }
                            
                            lastDeltaY += steps * this.swipeThreshold * (direction > 0 ? 1 : -1);
                        }
                    });
                    
                    document.addEventListener('mouseup', () => {
                        if (isDragging) {
                            this.snapToNearest(index);
                        }
                        isDragging = false;
                    });
                });
                
                enterBtn.addEventListener('click', (e) => {
                    this.checkCode();
                    e.preventDefault();
                });
                
                enterBtn.addEventListener('touchend', (e) => {
                    this.checkCode();
                    e.preventDefault();
                });
                
                // Keyboard support
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !this.isAnimating) {
                        this.checkCode();
                    }
                    if (e.key >= '0' && e.key <= '9' && !this.isAnimating) {
                        const index = parseInt(e.key) % this.dials;
                        this.rotateDialWithDirection(index, 1);
                    }
                });
            }
            
            rotateDialWithDirection(index, direction) {
                if (this.isAnimating) return;
                
                this.isAnimating = true;
                const dial = this.element.querySelectorAll('.dial')[index];
                const ol = dial.querySelector('ol');
                
                // به‌روزرسانی کد فعلی
                this.currentCode[index] = (this.currentCode[index] + direction + 10) % 10;
                
                // محاسبه موقعیت جدید
                const newTop = - (this.currentCode[index] * 45);
                
                // انیمیشن روان
                const animationDuration = 0.2; // کاهش زمان انیمیشن برای پاسخ‌دهی بهتر
                ol.style.transition = `top ${animationDuration}s cubic-bezier(0.25, 0.46, 0.45, 0.94)`;
                ol.style.top = `${newTop}px`;
                
                setTimeout(() => {
                    // ریست چرخش بی‌پایان
                    if (this.currentCode[index] === 0 && direction === 1) {
                        ol.style.transition = 'none';
                        ol.style.top = '0px';
                    } else if (this.currentCode[index] === 9 && direction === -1) {
                        ol.style.transition = 'none';
                        ol.style.top = '-450px';
                    }
                    this.isAnimating = false;
                }, animationDuration * 1000 + 50); // اضافه کردن buffer کوچک
                
                this.updateDisplay();
            }
            
            snapToNearest(index) {
                // برای اسنپ کردن به نزدیک‌ترین عدد - در این نسخه ساده، چون گام‌به‌گام است، نیاز نیست
            }
            
            checkCode() {
                const enteredCode = this.currentCode.join('');
                const statusDisplay = document.getElementById('statusDisplay');
                
                if (enteredCode === this.correctCode) {
                    this.isLocked = false;
                    statusDisplay.textContent = '✅ باز شد!';
                    statusDisplay.className = 'status-display success';
                    this.playSuccessSound();
                    this.celebrateUnlock();
                } else {
                    // نمایش پیام خطا برای 2 ثانیه - بالای صفحه
                    this.showErrorMessage();
                    statusDisplay.textContent = '❌ رمز اشتباه';
                    statusDisplay.className = 'status-display';
                    this.playErrorSound();
                    this.shakeAnimation();
                }
                
                setTimeout(() => {
                    if (!this.isLocked) {
                        statusDisplay.textContent = '🔓 باز';
                    } else {
                        statusDisplay.textContent = '🔒 قفل شده';
                    }
                    statusDisplay.className = 'status-display';
                }, 2000);
            }
            
            showErrorMessage() {
                this.errorMessage.classList.add('show');
                
                // مخفی کردن پیام بعد از 2 ثانیه
                setTimeout(() => {
                    this.errorMessage.classList.remove('show');
                }, 2000);
            }
            
            updateDisplay() {
                const currentCombo = document.getElementById('currentCombo');
                currentCombo.textContent = this.currentCode.join('');
            }
            
            celebrateUnlock() {
                const lock = this.element;
                lock.style.animation = 'unlockCelebrate 1s ease-in-out';
                
                if (!document.getElementById('celebrate-styles')) {
                    const style = document.createElement('style');
                    style.id = 'celebrate-styles';
                    style.textContent = `
                        @keyframes unlockCelebrate {
                            0% { transform: scale(1) rotate(0deg); }
                            25% { transform: scale(1.05) rotate(1deg); }
                            50% { transform: scale(1.1) rotate(-1deg); }
                            75% { transform: scale(1.05) rotate(1deg); }
                            100% { transform: scale(1) rotate(0deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                setTimeout(() => {
                    lock.style.animation = '';
                }, 1000);
            }
            
            shakeAnimation() {
                const lock = this.element;
                lock.style.animation = 'shake 0.5s ease-in-out';
                
                if (!document.getElementById('shake-styles')) {
                    const style = document.createElement('style');
                    style.id = 'shake-styles';
                    style.textContent = `
                        @keyframes shake {
                            0%, 100% { transform: translateX(0); }
                            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                            20%, 40%, 60%, 80% { transform: translateX(5px); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                setTimeout(() => {
                    lock.style.animation = '';
                }, 500);
            }
            
            playSuccessSound() {
                // Mobile vibration pattern for success
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                    const audioContext = new (AudioContext || webkitAudioContext)();
                    
                    // Play success melody
                    const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                    notes.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.15);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime + index * 0.15);
                        gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + index * 0.15 + 0.02);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.15 + 0.3);
                        
                        oscillator.start(audioContext.currentTime + index * 0.15);
                        oscillator.stop(audioContext.currentTime + index * 0.15 + 0.3);
                    });
                }
            }
            
            playErrorSound() {
                // Mobile vibration for error
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                    const audioContext = new (AudioContext || webkitAudioContext)();
                    
                    // Play error sound (two low tones)
                    const frequencies = [200, 150];
                    frequencies.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.2);
                        oscillator.type = 'sawtooth';
                        
                        gainNode.gain.setValueAtTime(0.08, audioContext.currentTime + index * 0.2);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.2 + 0.2);
                        
                        oscillator.start(audioContext.currentTime + index * 0.2);
                        oscillator.stop(audioContext.currentTime + index * 0.2 + 0.2);
                    });
                }
            }
        }

        // Initialize the lock when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const lockElement = document.getElementById('lock');
            new CombinationLock(lockElement, {
                dials: 4,
                correctCode:'5263' // رمز قفل
            });
        });

        // Prevent zoom on double tap for iOS - بهبود یافته
        let lastTouchEnd = 0;
        document.addEventListener('touchstart', function (event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });

        let lastTouchStart = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchStart <= 300) {
                event.preventDefault();
            }
            lastTouchStart = now;
        }, { passive: false });

        // جلوگیری از zoom در Safari iOS
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
